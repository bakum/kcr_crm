package ua.divas.view;

import java.math.BigDecimal;

import oracle.adf.model.BindingContext;
import oracle.adf.model.binding.DCDataControl;

import oracle.jbo.Row;
import oracle.jbo.RowSet;
import oracle.jbo.server.ViewObjectImpl;

import ua.divas.classes.DivasView;
import ua.divas.module.AppModuleImpl;
import ua.divas.view.common.ObjectDeleted;
// ---------------------------------------------------------------------
// ---    File generated by Oracle ADF Business Components Design Time.
// ---    Mon Jul 27 19:31:45 EEST 2015
// ---    Custom code may be added to this class.
// ---    Warning: Do not modify method signatures of generated methods.
// ---------------------------------------------------------------------
public class ObjectDeletedImpl extends DivasView implements ObjectDeleted {
    /**
     * This is the default constructor (do not remove).
     */
    public ObjectDeletedImpl() {
    }

    public void deleteRec(String p_id, String p_tablename) {
        callStoredProcedure("REPORT_PKG.delete_table(?,?)", new Object[] { p_id, p_tablename });
    }

    public void deleteSelectedRowsObj() {
        RowSet duplicateRowSet = this.createRowSet("duplicateRowSet");
        duplicateRowSet.first();
        Row currentRow = this.getCurrentRow();
        boolean currentRowDeleted = false;
        Row[] rowsToDelete = duplicateRowSet.getFilteredRows("Mark", 1);
        try {
            if (rowsToDelete.length > 0) {
                for (Row rw : rowsToDelete) {
                    if (rw.getKey().equals(currentRow.getKey())) {
                        currentRowDeleted = true;
                    }
                    String pId = (String) rw.getAttribute("TableId");
                    String pTableName = (String) rw.getAttribute("TableName");
                    deleteRec(pId, pTableName);
                }
                this.executeQuery();
                if (!currentRowDeleted) {
                    this.setCurrentRow(currentRow);
                }

            }
        } catch (Exception e) {
            // TODO: Add catch code
            e.printStackTrace();
        } finally {
            duplicateRowSet.closeRowSet();
        }
    }
}

